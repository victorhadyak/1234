receivers:
  otlp:
    protocols:
      grpc:
      http:
  prometheus:
    config:
      scrape_configs:
        - job_name: 'otel-collector'
          static_configs:
            - targets: ['localhost:5555']

processors:
  batch:
    timeout: 5s
  transform:
    metric_statements:
      - context: datapoint
        statements:
          # Example transformation to ensure correct naming
          - rename(metric.name, "plain_text_metric", "custom_mymonitor")
          - set(metric.type, "sum")
          - set(metric.unit, "1")
          - set(attributes["job"], "otel_job")
          - set(attributes["instance"], "otel_instance")

exporters:
  prometheus:
    endpoint: "0.0.0.0:9464"
    namespace: "otel"
  prometheusremotewrite:
    endpoint: "http://<pushgateway_host>:9091/metrics/job/my_job"

service:
  pipelines:
    metrics:
      receivers: [otlp, prometheus]
      processors: [batch, transform]
      exporters: [prometheus, prometheusremotewrite]
