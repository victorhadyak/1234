# Configure the AWS provider
provider "aws" {
  region = "us-west-2"  # Update to your specific region
}

# Retrieve the Grafana token from AWS Secrets Manager
data "aws_secretsmanager_secret_version" "grafana_token" {
  secret_id = "dev/grafana/token"
}

# Configure the Grafana provider
provider "grafana" {
  url   = "https://your-grafana-instance.com"  # Replace with your Grafana URL
  auth  = data.aws_secretsmanager_secret_version.grafana_token.secret_string
}

# Example Grafana dashboard resource
resource "grafana_dashboard" "example" {
  config_json = jsonencode({
    "dashboard" : {
      "id"      : null,
      "title"   : "Example Dashboard",
      "panels"  : [
        {
          "type"  : "graph",
          "title" : "Sample Panel",
          "gridPos": { "x": 0, "y": 0, "w": 24, "h": 9 }
        }
      ],
      "schemaVersion": 16,
      "version": 0
    },
    "overwrite": true
  })
}

# Example output to verify the dashboard ID (Optional)
output "dashboard_id" {
  value = grafana_dashboard.example.id
}

# Optional: Output the Grafana token (Sensitive)
output "grafana_token" {
  value     = data.aws_secretsmanager_secret_version.grafana_token.secret_string
  sensitive = true
}
